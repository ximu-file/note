# 知乎爬虫



目前在学习MySQL时候遇到的问题：目前数据库的表是单表，只有用户信息表，很多MySQL的join 或则 union 没法测试。随意需要多表信息，基于已有代码，需要新的feature是：



- [ ] 10-17 到 11-3 号， 只爬了150W用户数据，到后面越来越慢，速度很慢。

1. 用户重复的情况越来越严重，后面请求中，新用户命中率不足5%
2. 循环关注的情况，如果A关注了B，B关注了A。当爬A时，会访问B，爬B时会访问A，然后会重复爬A。里面就会有死循环，占用大量线程资源。说白了也就是要解决==去重问题（百万甚至千万级别去重）==。



爬取是深度优先还是宽度优先？

目前的代码有点像宽度优先遍历。



比如从A出发， A关注了B1到B1000，

1）从A出发，爬取A所有关注的用户B1~B1000;

2）然后从B1出发，爬取B1关注的用户，有C1-C1000，里面包含A。



目前的核心是做一个过滤： 如果对某一个用户的关注的用户列表提前做一个过滤，已经爬取过的用户不再爬取。



# target

- [ ] 爬取每个用户回答的问题



- [ ] 爬取每个用户提问



- [ ] 最近动态



- [ ] 发表文章




# 爬取每个用户回答的问题

- 每个用户回答的问题，每个用户的量区别很大，有的用户回答问题有万级别，有的是个位数甚至为0.
- 通过传入一个  user_token  就可以获取到该用户回答的所有答案。
- 线程池怎么维护？这里可能需要深入研究一下 JDK 里面的线程池实现原理。
- task里面要考虑用户换了 user_token 的问题，如果换了，需要打点，然后try catch处理。
- 如果爬取失败了， retry()应该限制重试的次数，如果多次都失败，就放弃。




- [x] 线程池扩展








# 可传入的参数的数量



|                 字段                  |      含义       |
| :---------------------------------: | :-----------: |
|             educations              |      学校       |
|             employments             |     就职公司      |
|            answer_count             |      回答数      |
|              business               |      行业       |
|              locations              |      位置       |
|           articles_count            |      文章数      |
|           follower_count            |      粉丝数      |
|               gender                |      性别       |
|           following_count           |     关注人数      |
|           question_count            |      提问数      |
|            voteup_count             |      赞同数      |
|            thanked_count            |      感谢数      |
|             is_followed             | 当前用户是否关注了该用户  |
|            is_following             | 当前用户是否被该用户关注了 |
| badge[?(type=best_answerer)].topics |               |
|                                     |               |
|                                     |               |
|                                     |               |
|                                     |               |





















